function Setting(){var a="undefined";(self=this).refreshSetting=function(){$.ajax({url:"/updateSetting"}).done(function(c){for(var b in a=c,c)c.hasOwnProperty(b)&&"txt"==(b=b.split(","))[0]&&$('<div class="row  mt-3" >  <div class="col" >  <p id="debug">'+b[1]+'</p> </div>  <div class="col">  <p> '+("1"==c["sw,TESTING SOFTWARE"]?"tst_"+c[b[0]+","+b[1]]:c[b[0]+","+b[1]])+"</p> </div> </div>").appendTo("#settingTable");for(var b in $("#updateSetting").html(c.datalayer),c)if(c.hasOwnProperty(b)&&"sw"==(b=b.split(","))[0]){if("TESTING SOFTWARE"==b[1]&&"0"==c[b[0]+","+b[1]])continue;$('<div class="row  mt-4">  <div class="col" >  <p>'+b[1]+'</p> </div>  <div class="col">  <input id="'+b[1]+'"  type="checkbox" name="btn-checkbox" data-toggle="witchbutton"> </div> </div>').appendTo("#settingTable"),"1"==c[b[0]+","+b[1]]?document.getElementById(b[1]).switchButton("on",!0):document.getElementById(b[1]).switchButton("off",!1)}for(var b in c)c.hasOwnProperty(b)&&"btn"==(b=b.split(","))[0]&&$('<div class="row  mt-4 mb-3" >  <div class="col" >  <p id="'+b[1]+'">'+b[1]+'</p> </div><div class="col"><div class="btn-group btn-group-toggle" id="PV" data-toggle="buttons"><label id="PV0" class="btn btn-outline-primary 0"><input type="radio" name="options" checked> Off </label><label id="PV1" class="btn btn-outline-primary 1"><input type="radio" name="options" checked> 1F </label><label id="PV2" class="btn btn-outline-primary 2"><input type="radio" name="options" checked> 3F </label></div></div></div>').appendTo("#settingTable");for(var b in $("#PV"+c["btn,PHOTOVOLTAIC"]).toggleClass("active"),c)c.hasOwnProperty(b)&&"bt"==(b=b.split(","))[0]&&$('<div class="row  mt-4 mb-3" >  <div class="col" >  <p id="'+b[1]+'">'+b[1]+'</p> </div>  <div class="col"> <button  id="resetEsp" type="button" class="btn btn-danger">RESET</button>  </div> </div>').appendTo("#settingTable");for(var b in $('.switch input[type="checkbox"]').on("change",function(){self.saveSetting("sw,"+$(this).attr("id"),1==$(this).prop("checked")?1:0)}),$("#updateSetting").html(c.datalayer),c)c.hasOwnProperty(b)&&"in"==(b=b.split(","))[0]&&$('<div class="row mt-4"><div class="col align-self-center"><p>'+b[1]+'</p></div></div><div class="row"><div class="col"><div class="input-group" style="display: block; margin:auto;"><span class="input-group-btn"><button id="'+b[0]+","+b[1]+'" class="btnF btn-primary btn-minuse" type="button">-</button></span><input id="'+b[0]+b[1]+'"type="text" class="add-color text-center height-25" maxlength="3" size="8" value="'+c[b[0]+","+b[1]]+'"><span class="input-group-btn"><button  id="'+b[0]+","+b[1]+'" class="btnF btn-primary btn-plus" type="button">+</button> </span></div></div></div></div><div class="container mt-2"><div class="row"> <button  style="margin:auto" id="'+b[0]+","+b[1]+'" type="button" class="btnF btn-light btn-s saveValue">SAVE</button>  </div></div>').appendTo("#settingTable");var d=60;$(document).on("click","#resetEsp",function(a){setInterval(resetCounter,1e3),setTimeout(function(){location.reload(!0),d=0,$("#resetEsp").text("FINISHING")},6e4),self.saveSetting("bt,RESET WATTMETER",1)}),resetCounter=function(){0!=d&&($("#resetEsp").text("WAITING "+d+"s"),d-=1)},$('<div id="settingResult" class="container">').appendTo("#settingTable"),self.evseSetting(c["in,EVSE-NUMBER"],c),self.checkUpdate(c["txt,ACTUAL SW VERSION"],c["sw,TESTING SOFTWARE"])})},this.refreshWifiClient=function(){$.ajax({url:"/updateWificlient"}).done(function(b){for(var a in $("#wifiStatus").html(""),$("#ssid").empty(),$("#updateWificlient").html(b.datalayer),b){var c;"connectSSID"==a?"None"==b[a]?($("#wifiStatus").text("Not connected to wifi"),$("#wifiStatus").css("color","#FF0000")):($("#wifiStatus").text("Currently connected to: "+b[a]),$("#wifiStatus").css("color","#74DF00")):b.hasOwnProperty(a)&&(c=b[a]<= -100?0:-50<=b[a]?100:2*(b[a]+100),$('<input class="essidRadio" type="radio" style="text-align:left;" name="ssid" value='+a+">"+a+": "+c+"%<br>").appendTo("#ssid"))}$("#refreshSSID").find("span").remove(),$(".loader").hide(100)})},this.checkUpdate=function(a,c){var b,d=parseFloat(a.substr(a.length-5,a.length));b="1"==c?"https://api.github.com/repos/smartmodul/test/contents/":"https://api.github.com/repos/smartmodul/production/contents/",$.ajax({url:b}).done(function(a){for(var b in a)(a[b].name.includes("tst")||a[b].name.includes("rev"))&&(sf=parseFloat(a[b].name.substr(a[b].name.length-5,a[b].name.length)))!=d&&($("#stat").text("New FW version is "+sf),$("#stat").css("color","red"),$("#val").text("Your FW is out of date. Enable automatic update and reset Smartmodule."),$("#myModal").modal("show"))})},this.evseSetting=function(c){for(var b=1;b<=c;b++)$('<div id="evseSett"  class="container-sm pt-2 mt-3 text-center bg border border-secondary"><span class="dim">EVSE setting: '+b+' </span></div><div class="row mt-3"><div class="col align-self-center"><p>CURRENT [A]</p></div></div><div class="row"><div class="col"><div class="input-group" style="display: block; margin:auto;"><span class="input-group-btn"><button id="inp,EVSE'+b+'" class="btnF btn-primary btn-minuse" type="button">-</button></span><input id="inpEVSE'+b+'" type="text" class="add-color text-center height-25" maxlength="2" size="8" value="'+a["inp,EVSE"+b]+'"><span class="input-group-btn"><button  id="inp,EVSE'+b+'" class="btnF btn-primary btn-plus" type="button">+</button> </span></div></div></div><div class="container mt-2"><div class="row"> <button  style="margin:auto" id="inp,EVSE'+b+'" type="button" class="btnF btn-light btn-s saveValue">SAVE</button>  </div></div>').appendTo("#evseSetting")},this.saveSetting=function(b,a){$("#val").text(""),$("#stat").text("WAITING.. "),$("#stat").append('<span class="spinner-border spinner-border-sm"></span>'),$("#stat").css("color","black"),$("#myModal").modal("show"),isNaN(a)?($("#stat").text("VARIABLE IS NOT NUMBER"),$("#stat").css("color","red")):$.ajax({type:"POST",url:"/updateSetting",async:!0,data:JSON.stringify({variable:b,value:a}),success:function(c){$("#updateSetting").html(c.datalayer),1==c.process?($("#val").text(b.split(",")[1]+" = "+a),$("#stat").text("SAVED SUCCESS!"),$("#stat").css("color","green")):($("#val").text(b.split(",")[1]+" = "+a),$("#stat").text("SAVED UNSUCCESS!"),$("#stat").css("color","red"))}})},this.modbusProccess=function(d,a,b,c){$("#modbusStatus").text(""),"read"==b?($("#modbusStatus").text("Reading register: "+a+" ..."),$("#readReg").append('<span class="spinner-border spinner-border-sm"></span>'),$("#modbusStatus").css("color","#FBD428")):"write"==b&&($("#modbusStatus").text("Writing register: "+a+" with value: "+c+" ..."),$("#writeReg").append('<span class="spinner-border spinner-border-sm"></span>'),$("#modbusStatus").css("color","#FBD428")),isNaN(a&&d&&c)?($("#modbusStatus").text("VARIABLE IS NOT NUMBER"),$("#modbusStatus").css("color","red"),$("#readReg").find("span").remove(),$("#writeReg").find("span").remove()):$.ajax({type:"POST",url:"/modbusRW",async:!0,data:JSON.stringify({type:b,id:d,reg:a,value:c}),success:function(a){$("#modbusRW").html(a.datalayer),1==a.process?($("#modbusStatus").text("Proccess successful"),$("#valueM").val(a.value),$("#modbusStatus").css("color","#74DF00"),$("#readReg").find("span").remove(),$("#writeReg").find("span").remove()):($("#modbusStatus").text("Proccess unsuccessful: "+a.value),$("#modbusStatus").css("color","red"),$("#readReg").find("span").remove(),$("#writeReg").find("span").remove())},error:function(){$("#modbusStatus").text("Response error"),$("#modbusStatus").css("color","red"),$("#writeReg").find("span").remove(),$("#readReg").find("span").remove()}})}}$(function(){var a=0;$(document).on("click","#setSSID",function(){$("#setSSID").append('<span class="spinner-border spinner-border-sm"></span>'),$("#wifiStatus").html("Waiting .... "),$("#wifiStatus").css("color","#FBD428"),password=$("#passwordField").val();var a=$("input[name='ssid']:checked").val();a?$.ajax({type:"POST",url:"/updateWificlient",async:!0,data:JSON.stringify({ssid:a,password:password}),success:function(b){$("#updateWificlient").html(b.datalayer),0==b.process?($("#wifiStatus").html("Please choose ssid client first!"),$("#wifiStatus").css("color","#FF0000")):1==b.process?($("#wifiStatus").html("Can not connect to Wattmeter SSID"),$("#wifiStatus").css("color","#FF0000")):2==b.process||3==b.process?($("#wifiStatus").html("Currently connected to: "+a),$("#wifiStatus").css("color","#74DF00")):($("#wifiStatus").html("Error during connection to: "+a),$("#wifiStatus").css("color","#FF0000"))}}):($("#wifiStatus").html("Please choose ssid client first!"),$("#wifiStatus").css("color","#FF0000")),$("#setSSID").find("span").remove()}),$(document).on("click","#refreshSSID",function(){$("#wifiStatus").text("Scanning wifi ...."),$("#refreshSSID").append('<span class="spinner-border spinner-border-sm"></span>'),self.refreshWifiClient()}),$(document).on("click",".btnF",function(){var a=this.id.replace(",",""),b=$("#"+this.id.replace(",","")).val();hodnota=0,$(this).hasClass("saveValue")&&self.saveSetting(this.id,b),$(this).hasClass("btn-minuse")&&("inEVSE-NUMBER"==a&&(parseInt(b)-1<0?(hodnota=0,$("#"+a).val(0)):(hodnota=parseInt(b)-1,$("#"+a).val(hodnota)),$("#evseSetting").children().remove(),self.evseSetting(hodnota)),"inMAX-CURRENT-FROM-GRID-A"==a&&(parseInt(b)-1<0?(hodnota=0,$("#"+a).val(0)):(hodnota=parseInt(b)-1,$("#"+a).val(hodnota))),"inPHOTOVOLTAIC-A"==a&&(parseInt(b)-1<0?(hodnota=0,$("#"+a).val(0)):(hodnota=parseInt(b)-1,$("#"+a).val(hodnota))),"inTIME-ZONE"==a&&(parseInt(b)-1< -24?(hodnota=-24,$("#"+a).val(-24)):(hodnota=parseInt(b)-1,$("#"+a).val(hodnota))),a.includes("inpEVSE")&&(parseInt(b)-1<0?(hodnota=0,$("#"+a).val(0)):(hodnota=parseInt(b)-1,$("#"+a).val(hodnota)))),$(this).hasClass("btn-plus")&&("inEVSE-NUMBER"==a&&(parseInt(b)+1>10?(hodnota=10,$("#"+a).val(10)):(hodnota=parseInt(b)+1,$("#"+a).val(hodnota)),$("#evseSetting").children().remove(),self.evseSetting(hodnota)),"inMAX-CURRENT-FROM-GRID-A"==a&&(parseInt(b)+1>125?(hodnota=125,$("#"+a).val(125)):(hodnota=parseInt(b)+1,$("#"+a).val(hodnota))),"inPHOTOVOLTAIC-A"==a&&(parseInt(b)+1>125?(hodnota=125,$("#"+a).val(125)):(hodnota=parseInt(b)+1,$("#"+a).val(hodnota))),"inTIME-ZONE"==a&&(parseInt(b)+1>24?(hodnota=24,$("#"+a).val(24)):(hodnota=parseInt(b)+1,$("#"+a).val(hodnota))),a.includes("inpEVSE")&&(parseInt(b)+1>99?(hodnota=99,$("#"+a).val(99)):(hodnota=parseInt(b)+1,$("#"+a).val(hodnota))))}),$(document).on("click","#debug",function(){a+=1,setTimeout(function(){a=0},1e4),a>20&&($(".modal-body").text("Please reset wattmeter to switch testing FW"),$("#myModal").modal("show"),self.saveSetting("sw,TESTING SOFTWARE",1))}),$(document).on("click","#readReg",function(){self.modbusProccess($("#id").val(),$("#register").val(),"read",0)}),$(document).on("click","#writeReg",function(){self.modbusProccess($("#id").val(),$("#register").val(),"write",$("#valueM").val())}),$(document).on("click","#PV0",function(){self.saveSetting("btn,PHOTOVOLTAIC",0)}),$(document).on("click","#PV1",function(){self.saveSetting("btn,PHOTOVOLTAIC",1)}),$(document).on("click","#PV2",function(){self.saveSetting("btn,PHOTOVOLTAIC",2)})})