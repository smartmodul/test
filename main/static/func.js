function updateData(){$.ajax({url:"/updateData"}).done(function(t){$("#WATTMETER_TIME").text(t.WATTMETER_TIME);let a=parseInt(t.RUN_TIME,10),n=Math.floor((a-=3600*(s=Math.floor(a/86400))*24)/3600),r=Math.floor((a-=3600*n)/60);a-=60*r,$("#RUN_TIME").text((s<10?"0"+s:s)+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)+":"+(a<10?"0"+a:a)),$("#U1").text(t.U1),$("#U2").text(t.U2),$("#U3").text(t.U3),$("#I1").text(rnd(t.I1,100,2,!0)),$("#I2").text(rnd(t.I2,100,2,!0)),$("#I3").text(rnd(t.I3,100,2,!0)),$("#P1").text(rnd(t.P1,1e3,2,!0)),$("#P2").text(rnd(t.P2,1e3,2,!0)),$("#P3").text(rnd(t.P3,1e3,2,!0)),t.A>0?($("#AC_IN").text("ON"),$("#AC_IN").css("color","#74DF00")):($("#AC_IN").text("OFF"),$("#AC_IN").css("color","#FF0000")),$("#PP1p").text(rnd(t.W1,1e3,1)),$("#PP2p").text(rnd(t.W2,1e3,1)),$("#PP3p").text(rnd(t.W3,1e3,1)),$("#E1dP").text(rnd(t.E1dP,100,1)),$("#E2dP").text(rnd(t.E2dP,100,1)),$("#E3dP").text(rnd(t.E3dP,100,1)),t.E1tP/100>1e6||t.E2tP/100>1e6||t.E3tP/100>1e6?($("#E1tP").text(rnd(t.E1tP,1e8,2)),$("#E2tP").text(rnd(t.E2tP,1e8,2)),$("#E3tP").text(rnd(t.E3tP,1e8,2)),$("#Ep").text(translate("totalEp")+" \n[GWh]")):t.E1tP/100>1e3||t.E2tP/100>1e3||t.E3tP/100>1e3?($("#E1tP").text(rnd(t.E1tP,1e5,2)),$("#E2tP").text(rnd(t.E2tP,1e5,2)),$("#E3tP").text(rnd(t.E3tP,1e5,2)),$("#Ep").text(translate("totalEp")+" \n[MWh]")):($("#E1tP").text(rnd(t.E1tP,100,1)),$("#E2tP").text(rnd(t.E2tP,100,1)),$("#E3tP").text(rnd(t.E3tP,100,1)),$("#Ep").text(translate("totalEp")+" \n[kWh]")),t.E1tN/100>1e6||t.E2tN/100>1e6||t.E3tN/100>1e6?($("#E1tN").text(rnd(t.E1tN,1e8,2)),$("#E2tN").text(rnd(t.E2tN,1e8,2)),$("#E3tN").text(rnd(t.E3tN,1e8,2)),$("#En").text(translate("totalEn")+" \n[GWh]")):t.E1tN/100>1e3||t.E2tN/100>1e3||t.E3tN/100>1e3?($("#E1tN").text(rnd(t.E1tN,1e5,2)),$("#E2tN").text(rnd(t.E2tN,1e5,2)),$("#E3tN").text(rnd(t.E3tN,1e5,2)),$("#En").text(translate("totalEn")+" \n[MWh]")):($("#E1tN").text(rnd(t.E1tN,100,1)),$("#E2tN").text(rnd(t.E2tN,100,1)),$("#E3tN").text(rnd(t.E3tN,100,1)),$("#En").text(translate("totalEn")+" \n[kWh]")),$("#Current_EP").text(rnd(t.E1dP+t.E2dP+t.E3dP,100,2)),$("#Previous_EP").text(rnd(t.EpDP,100,2)),$("#Total_EP").text(rnd(t.E1tP+t.E2tP+t.E3tP,100,0)),$("#ID").text(t.ID),dailyEnergyData=t.D,monthlyEnergyData=t.M,powerAVGchartData=t.Pm,dotControl()})}function rnd(t,a,n,r){return!0==r?((t>32767?t-65535:t)/a).toFixed(n):(t/a).toFixed(n)}function chargingAnim(t,a){for(var n=1;n<5;n++)$(".charge"+n).css("animation-play-state",t),$(".charge"+n).css({"background-color":a})}function handleEvseAPI(t,a,n){$("#ACTUAL_CONFIG_CURRENT1").text(void 0!==t?t+" A":"COMM ERR."),$("#ACTUAL_OUTPUT_CURRENT1").text(void 0!==a?a+" A":"COMM ERR."),n<1||n>3?($("#EV_STATE1").text("COMM ERR."),chargingAnim("paused","inherit")):1==n?($("#EV_STATE1").text(translate("unplug")),chargingAnim("paused","inherit"),$(".charge1").css({"background-color":"red"})):2==n?($("#EV_STATE1").text(translate("plug")),chargingAnim("paused","inherit"),$(".charge1").css({"background-color":"yellow"})):3==n&&($("#EV_STATE1").text(translate("charging")),chargingAnim("running","green"))}function dotControl(){elements=$("#dot");for(var t=0;t<elements.length;t++)"grey"==elements[t].style.color?elements[t].style.color="#34ECE1":elements[t].style.color="grey"}function getTime(){var t=new Date,a=""+(t.getMonth()+1);return[""+t.getDate(),a,t.getFullYear(),t.getHours(),t.getMinutes(),t.getSeconds()]}function loadPowerChart(){len=powerAVGchartData[0];for(var t,a=1;a<61-len;a++)powerGraph.config.data.datasets.forEach(function(t){t.data.push({x:Date.now()-1e3*(61-a)*60,y:0})});for(a=1;a<len;a++)t=null!=powerAVGchartData[a]?powerAVGchartData[a]:0,powerGraph.config.data.datasets.forEach(function(n){n.data.push({x:Date.now()-1e3*(len-a)*60,y:t})});powerGraph.update()}function refreshEnergyChartDaily(){var t=0,a=1;null!=dailyEnergyData&&(a=dailyEnergyData.length-1),days=Last31Days();for(var n=0;n<31;n++)null!=dailyEnergyData&&null!=dailyEnergyData[a-n]?(t=(arr=dailyEnergyData[a-n].split(":"))[0],dataP=(dat=JSON.parse(arr[1]))[0],dataN=dat[1],energyBarGraph.data.labels[30-n]=t,energyBarGraph.data.datasets[0].data[30-n]=parseFloat(dataP/100).toFixed(1),energyBarGraph.data.datasets[1].data[30-n]=-parseFloat(dataN/100).toFixed(1)):(energyBarGraph.data.labels[30-n]=days[n],energyBarGraph.data.datasets[0].data[30-n]=0,energyBarGraph.data.datasets[1].data[30-n]=0);for(var r=0;r<31;r++)energyBarGraph.data.datasets[2].data[r]=getAvgEnergy(dailyEnergyData,31);energyBarGraph.update()}function refreshEnergyChartMonthly(){var t=0,a=1;null!=monthlyEnergyData&&(a=monthlyEnergyData.length-1),days=Last12Month();for(var n=0;n<12;n++)null!=monthlyEnergyData&&null!=monthlyEnergyData[a-n]?(t=(arr=monthlyEnergyData[a-n].split(":"))[0],dataP=(dat=JSON.parse(arr[1]))[0],dataN=dat[1],energyBarGraph.data.labels[11-n]=t,energyBarGraph.data.datasets[0].data[11-n]=parseFloat(dataP/100).toFixed(1),energyBarGraph.data.datasets[1].data[11-n]=-parseFloat(dataN/100).toFixed(1)):(energyBarGraph.data.labels[11-n]=days[n],energyBarGraph.data.datasets[0].data[11-n]=0,energyBarGraph.data.datasets[1].data[11-n]=0);for(var r=0;r<12;r++)energyBarGraph.data.datasets[2].data[r]=getAvgEnergy(monthlyEnergyData,12);energyBarGraph.update()}function getAvgEnergy(t,a){for(var n=0,r=0,_=0;_<a;_++)null!=t&&null!=t[_]&&(dataP=(dat=JSON.parse((arr=t[_].split(":"))[1]))[0],dataN=dat[1],n=n+parseFloat(dataP/100)-parseFloat(dataN/100),r++);return(n/r).toFixed(1)}function Last31Days(){for(var t=[],a=1;a<32;a++){var n=new Date;n.setDate(n.getDate()-a),t.push(formatDate(n))}return t}function Last12Month(){var t=new Date,a=[];for(i=0;i<=11;i++)a.push(t.getMonth()+1+"/"+t.getFullYear().toString().substr(-2)),t.setMonth(t.getMonth()-1);return a}function formatDate(t){var a=t.getDate(),n=t.getMonth()+1;return a<10&&(a="0"+a),n<10&&(n="0"+n),(n+"/"+a+"/"+t.getFullYear().toString().substr(-2)).toString()}function openNav(){$("#mySidenav").css("width","250px")}function closeNav(){$("#mySidenav").css("width","0")}function updateOverView(t,a){handleEvseAPI(a.ACTUAL_CONFIG_CURRENT,a.ACTUAL_OUTPUT_CURRENT,a.EV_STATE),$("#maxCurrent").text(a.ACTUAL_CONFIG_CURRENT),$("#power").text(rnd(t.P1+t.P2+t.P3,1e3,1)),$("#energy").text(rnd(t.P1+t.P2+t.P3,1e3,2)),powerAVGchartData=t.Pm,hourEnergyData=t.Es,dailyEnergyData=t.D,$("#duration").text(a.DURATION),$("#user").text(a.USER),dotControl()}powerAVGchartData=0,hourEnergyData=[],dailyEnergyData=[],monthlyEnergyData=[],selectedEnergy="hourly",powerGraph="undefined",energyBarGraph="undefined",energyPieGraph="undefined",timer=0,$(function(){$("div.mainContainer").load("overview",function(){new _evse(1).createEvseGauge(),new _CreateOverView,$("#sideText").text("☰ "+translate("overview")),translatePage(),$.ajax({url:"/updateData"}).done(function(t){$.ajax({url:"/updateEvse"}).done(function(a){updateOverView(t,a),$(".loader").hide(100)})}),timer=setInterval(function(){$.ajax({url:"/updateData"}).done(function(t){$.ajax({url:"/updateEvse"}).done(function(a){updateOverView(t,a)})})},2e3)}),$("#mySidenav a").click(function(t){"overview"==$(this).attr("id")?(clearTimeout(timer),$("div.mainContainer").load("overview",function(){$("#sideText").text("☰ "+translate("overview")),new _evse(1).createEvseGauge(),handleEvseAPI(0,0,0),new _CreateOverView,translatePage(),$.ajax({url:"/updateData"}).done(function(t){$.ajax({url:"/updateEvse"}).done(function(a){updateOverView(t,a)})}),timer=setInterval(function(){$.ajax({url:"/updateData"}).done(function(t){$.ajax({url:"/updateEvse"}).done(function(a){updateOverView(t,a)})})},2e3)})):"data"==$(this).attr("id")?(clearTimeout(timer),$("div.mainContainer").load("datatable",function(){$("#sideText").text("☰ "+translate("data")),new _CreateDataTable,translatePage(),updateData(),timer=setInterval(function(){updateData()},2e3)})):"rfid"==$(this).attr("id")?(clearTimeout(timer),$("div.mainContainer").load("rfid",function(){$("#sideText").text("☰ Rfid"),new RfidContext,$.ajax({url:"/updateRFID"}).done(function(t){new CreateRfidList(t)})})):"settings"==$(this).attr("id")?(clearTimeout(timer),$("div.mainContainer").load("settings",function(){$("#sideText").text("☰ "+translate("settings")),$("#Lw").text(translate("p_setting")),$(".loader").show(),setting.refreshSetting(),setting.refreshWifiClient(),evseInstanceGauge="undefined"})):"history"==$(this).attr("id")?(clearTimeout(timer),$("div.mainContainer").load("history",function(){$("#sideText").text("☰ "+translate("history"))})):"energyChart"==$(this).attr("id")&&(clearTimeout(timer),$("div.mainContainer").load("energyChart",function(){evseInstanceGauge="undefined",$("#sideText").text("☰ "+translate("en"));var t=new energyChart("","Daily E [kWh]","kWh");(o=$("#barEnergy")).height("75vh"),d=t.getConfig(31),(energyBarGraph=new Chart(o,d)).getDatasetMeta(1).hidden=!0,selectedEnergy="daily",updateData(),translatePage(),timer=setInterval(function(){$.ajax({url:"/updateData"}).done(function(t){$("#updateData").html(t.datalayer),dailyEnergyData=t.D,monthlyEnergyData=t.M,"daily"===selectedEnergy?refreshEnergyChartDaily():"monthly"===selectedEnergy&&refreshEnergyChartMonthly(),dotControl()})},2e4),refreshEnergyChartDaily()}))}),$(document).on("click","#synchroTime",function(){$("#synchroTime").append('<span class="spinner-border spinner-border-sm"></span>'),(e=getTime())&&$.ajax({type:"POST",url:"/updateData",async:!0,data:JSON.stringify({time:e}),success:function(t){$("#updateData").html(t.datalayer),$("#synchroTime").find("span").remove()}})}),$(document).on("click","#relay",function(){e=1,$.ajax({type:"POST",url:"/updateData",async:!0,data:JSON.stringify({relay:e}),success:function(t){$("#updateData").html(t.datalayer),1==t.process?($("#RELAY").text("ON"),$("#RELAY").css("color","#74DF00")):($("#RELAY").text("OFF"),$("#RELAY").css("color","#FF0000"))}})}),$(document).on("click","#dayE",function(){selectedEnergy="daily",energyBarGraph.clear(),energyBarGraph.destroy();var t=new energyChart("","Daily E [kWh]","kWh");(o=$("#barEnergy")).height("75vh"),d=t.getConfig(31),(energyBarGraph=new Chart(o,d)).getDatasetMeta(1).hidden=!0,refreshEnergyChartDaily()}),$(document).on("click","#monthE",function(){selectedEnergy="monthly",energyBarGraph.clear(),energyBarGraph.destroy();var t=new energyChart("","Monthly E [kWh]","kWh");(o=$("#barEnergy")).height("75vh"),d=t.getConfig(12),(energyBarGraph=new Chart(o,d)).getDatasetMeta(1).hidden=!0,refreshEnergyChartMonthly()})});